# 魔术方法

Python的魔术方法（Magic Methods）

## 构造和初始化

- `__new__(cls, ...)`: 创建类的新实例
- `__init__(self, ...)`: 初始化新创建的实例
- `__del__(self)`: 在对象被垃圾回收前调用

## 字符串表示

- `__str__(self)`: 定义对象的字符串表示，由`str()`和`print()`调用
- `__repr__(self)`: 定义对象的"官方"字符串表示，由`repr()`调用
- `__format__(self, format_spec)`: 定义`format()`和f-string如何格式化对象

## 比较操作

- `__eq__(self, other)`: 定义`==`操作符的行为
- `__ne__(self, other)`: 定义`!=`操作符的行为
- `__lt__(self, other)`: 定义`<`操作符的行为
- `__gt__(self, other)`: 定义`>`操作符的行为
- `__le__(self, other)`: 定义`<=`操作符的行为
- `__ge__(self, other)`: 定义`>=`操作符的行为

## 数值操作

### 一元操作符

- `__pos__(self)`: 定义`+`一元操作符的行为
- `__neg__(self)`: 定义`-`一元操作符的行为
- `__abs__(self)`: 定义`abs()`函数的行为
- `__invert__(self)`: 定义`~`操作符的行为

### 二元操作符

- `__add__(self, other)`: 定义`+`操作符的行为
- `__sub__(self, other)`: 定义`-`操作符的行为
- `__mul__(self, other)`: 定义`*`操作符的行为
- `__matmul__(self, other)`: 定义`@`操作符的行为（矩阵乘法）
- `__truediv__(self, other)`: 定义`/`操作符的行为
- `__floordiv__(self, other)`: 定义`//`操作符的行为
- `__mod__(self, other)`: 定义`%`操作符的行为
- `__divmod__(self, other)`: 定义`divmod()`函数的行为
- `__pow__(self, other[, modulo])`: 定义`**`操作符和`pow()`函数的行为
- `__lshift__(self, other)`: 定义`<<`操作符的行为
- `__rshift__(self, other)`: 定义`>>`操作符的行为
- `__and__(self, other)`: 定义`&`操作符的行为
- `__xor__(self, other)`: 定义`^`操作符的行为
- `__or__(self, other)`: 定义`|`操作符的行为

### 反射操作符（右操作数）

- `__radd__(self, other)`: 定义当左操作数不支持`+`操作时的行为
- `__rsub__(self, other)`: 定义当左操作数不支持`-`操作时的行为
- `__rmul__(self, other)`: 定义当左操作数不支持`*`操作时的行为
- `__rmatmul__(self, other)`: 定义当左操作数不支持`@`操作时的行为
- `__rtruediv__(self, other)`: 定义当左操作数不支持`/`操作时的行为
- `__rfloordiv__(self, other)`: 定义当左操作数不支持`//`操作时的行为
- `__rmod__(self, other)`: 定义当左操作数不支持`%`操作时的行为
- `__rdivmod__(self, other)`: 定义当左操作数不支持`divmod()`操作时的行为
- `__rpow__(self, other)`: 定义当左操作数不支持`**`操作时的行为
- `__rlshift__(self, other)`: 定义当左操作数不支持`<<`操作时的行为
- `__rrshift__(self, other)`: 定义当左操作数不支持`>>`操作时的行为
- `__rand__(self, other)`: 定义当左操作数不支持`&`操作时的行为
- `__rxor__(self, other)`: 定义当左操作数不支持`^`操作时的行为
- `__ror__(self, other)`: 定义当左操作数不支持`|`操作时的行为

### 增量赋值操作符

- `__iadd__(self, other)`: 定义`+=`操作符的行为
- `__isub__(self, other)`: 定义`-=`操作符的行为
- `__imul__(self, other)`: 定义`*=`操作符的行为
- `__imatmul__(self, other)`: 定义`@=`操作符的行为
- `__itruediv__(self, other)`: 定义`/=`操作符的行为
- `__ifloordiv__(self, other)`: 定义`//=`操作符的行为
- `__imod__(self, other)`: 定义`%=`操作符的行为
- `__ipow__(self, other)`: 定义`**=`操作符的行为
- `__ilshift__(self, other)`: 定义`<<=`操作符的行为
- `__irshift__(self, other)`: 定义`>>=`操作符的行为
- `__iand__(self, other)`: 定义`&=`操作符的行为
- `__ixor__(self, other)`: 定义`^=`操作符的行为
- `__ior__(self, other)`: 定义`|=`操作符的行为

### 类型转换

- `__int__(self)`: 定义`int()`函数的行为
- `__float__(self)`: 定义`float()`函数的行为
- `__complex__(self)`: 定义`complex()`函数的行为
- `__round__(self, ndigits=0)`: 定义`round()`函数的行为
- `__trunc__(self)`: 定义`math.trunc()`函数的行为
- `__floor__(self)`: 定义`math.floor()`函数的行为
- `__ceil__(self)`: 定义`math.ceil()`函数的行为

## 容器类型

### 长度和成员检测

- `__len__(self)`: 定义`len()`函数的行为
- `__contains__(self, item)`: 定义`in`操作符的行为

### 索引和切片

- `__getitem__(self, key)`: 定义索引访问的行为，如`obj[key]`
- `__setitem__(self, key, value)`: 定义索引赋值的行为，如`obj[key] = value`
- `__delitem__(self, key)`: 定义删除索引项的行为，如`del obj[key]`

### 迭代

- `__iter__(self)`: 返回一个迭代器对象
- `__next__(self)`: 返回迭代器的下一个值
- `__reversed__(self)`: 定义`reversed()`函数的行为

## 上下文管理

- `__enter__(self)`: 定义进入`with`语句上下文的行为
- `__exit__(self, exc_type, exc_val, exc_tb)`: 定义退出`with`语句上下文的行为

## 描述符

- `__get__(self, instance, owner)`: 定义当描述符被访问时的行为
- `__set__(self, instance, value)`: 定义当描述符被赋值时的行为
- `__delete__(self, instance)`: 定义当描述符被删除时的行为
- `__set_name__(self, owner, name)`: 定义当描述符被分配给类属性时的行为

## 可调用对象

- `__call__(self, ...)`: 使实例可以像函数一样被调用

## 哈希和属性

- `__hash__(self)`: 定义`hash()`函数的行为
- `__getattr__(self, name)`: 当属性不存在时被调用
- `__getattribute__(self, name)`: 当任何属性被访问时被调用
- `__setattr__(self, name, value)`: 当属性被赋值时被调用
- `__delattr__(self, name)`: 当属性被删除时被调用
- `__dir__(self)`: 定义`dir()`函数的行为

## 类相关

- `__instancecheck__(self, instance)`: 定义`isinstance()`函数的行为
- `__subclasscheck__(self, subclass)`: 定义`issubclass()`函数的行为
- `__class_getitem__(cls, key)`: 支持类的参数化，如`list[int]`

## 协程相关

- `__await__(self)`: 返回一个可等待对象
- `__aiter__(self)`: 返回一个异步迭代器
- `__anext__(self)`: 返回异步迭代器的下一个值
- `__aenter__(self)`: 定义进入异步`with`语句上下文的行为
- `__aexit__(self, exc_type, exc_val, exc_tb)`: 定义退出异步`with`语句上下文的行为
