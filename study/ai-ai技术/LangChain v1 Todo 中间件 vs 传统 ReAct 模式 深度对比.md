
# LangChain v1 Todo 中间件 vs 传统 ReAct 模式 深度对比

## 一、架构本质区别

```
╔══════════════════════════════════════════════════════════════════════════════════════╗
║                                                                                      ║
║                           架构本质对比                                                ║
║                                                                                      ║
╠══════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                      ║
║   传统 ReAct 模式                                                                    ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │                                                                            │     ║
║   │   核心思想：用【提示词】教会模型遵循固定格式                                  │     ║
║   │                                                                            │     ║
║   │   提示词 ──► 模型生成文本 ──► 正则解析 ──► 执行动作 ──► 循环                 │     ║
║   │                                                                            │     ║
║   │   一切都是【文本】，通过【解析】提取意图                                      │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
║   LangChain v1 + Todo 中间件                                                         ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │                                                                            │     ║
║   │   核心思想：用【原生能力】+ 【状态机】+ 【中间件】实现智能体                   │     ║
║   │                                                                            │     ║
║   │   工具绑定 ──► 模型返回结构化 tool_calls ──► 状态机驱动 ──► 中间件增强        │     ║
║   │                                                                            │     ║
║   │   一切都是【结构化数据】，通过【API】直接获取意图                             │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
╚══════════════════════════════════════════════════════════════════════════════════════╝
```

---

## 二、ReAct 模式详解

### 2.1 ReAct 的提示词模板

```python
REACT_PROMPT = """Answer the following questions as best you can. You have access to the following tools:

{tools}

Use the following format:

Question: the input question you must answer
Thought: you should always think about what to do
Action: the action to take, should be one of [{tool_names}]
Action Input: the input to the action
Observation: the result of the action
... (this Thought/Action/Action Input/Observation can repeat N times)
Thought: I now know the final answer
Final Answer: the final answer to the original input question

Begin!

Question: {input}
Thought:"""
```

### 2.2 ReAct 的执行流程

```
╔══════════════════════════════════════════════════════════════════════════════════════╗
║                                                                                      ║
║                          传统 ReAct 执行流程                                          ║
║                                                                                      ║
╠══════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                      ║
║   用户输入: "今天北京天气怎么样？"                                                    ║
║                                                                                      ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ Step 1: 构造提示词                                                         │     ║
║   ├────────────────────────────────────────────────────────────────────────────┤     ║
║   │                                                                            │     ║
║   │   """                                                                      │     ║
║   │   Answer the following questions...                                        │     ║
║   │   You have access to: search, weather                                      │     ║
║   │   Use the following format:                                                │     ║
║   │   Thought: ...                                                             │     ║
║   │   Action: ...                                                              │     ║
║   │   ...                                                                      │     ║
║   │   Question: 今天北京天气怎么样？                                            │     ║
║   │   Thought:                                                                 │     ║
║   │   """                                                                      │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                      ↓                                               ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ Step 2: 模型生成【纯文本】                                                  │     ║
║   ├────────────────────────────────────────────────────────────────────────────┤     ║
║   │                                                                            │     ║
║   │   模型输出:                                                                 │     ║
║   │   "Thought: 用户想知道北京的天气，我需要调用天气工具                          │     ║
║   │    Action: weather                                                         │     ║
║   │    Action Input: {"location": "北京"}"                                     │     ║
║   │                                                                            │     ║
║   │   ⚠️ 这是纯文本！模型可能不遵循格式！                                        │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                      ↓                                               ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ Step 3: 正则表达式解析                                                      │     ║
║   ├────────────────────────────────────────────────────────────────────────────┤     ║
║   │                                                                            │     ║
║   │   # 解析代码                                                                │     ║
║   │   action_match = re.search(r"Action:\s*(.+)", output)                      │     ║
║   │   input_match = re.search(r"Action Input:\s*(.+)", output)                 │     ║
║   │                                                                            │     ║
║   │   action = action_match.group(1).strip()  # "weather"                      │     ║
║   │   action_input = json.loads(input_match.group(1))  # {"location": "北京"}  │     ║
║   │                                                                            │     ║
║   │   ⚠️ 解析可能失败！JSON 可能格式错误！                                       │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                      ↓                                               ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ Step 4: 执行工具，拼接 Observation                                          │     ║
║   ├────────────────────────────────────────────────────────────────────────────┤     ║
║   │                                                                            │     ║
║   │   result = weather(location="北京")  # "北京今天晴天，25度"                  │     ║
║   │                                                                            │     ║
║   │   # 拼接到提示词                                                            │     ║
║   │   prompt += f"\nObservation: {result}\nThought:"                           │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                      ↓                                               ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ Step 5: 再次调用模型                                                        │     ║
║   ├────────────────────────────────────────────────────────────────────────────┤     ║
║   │                                                                            │     ║
║   │   模型输出:                                                                 │     ║
║   │   "Thought: 我现在知道答案了                                                │     ║
║   │    Final Answer: 今天北京天气晴天，温度25度，适合出门！"                      │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                      ↓                                               ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ Step 6: 检测到 "Final Answer"，结束循环                                      │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
╚══════════════════════════════════════════════════════════════════════════════════════╝
```

### 2.3 ReAct 的问题

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                     │
│                            ReAct 模式的问题                                          │
│                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   1. 格式不稳定                                                                      │
│      - 模型可能不严格遵循 Thought/Action/Observation 格式                            │
│      - 可能输出 "Action：" (中文冒号) 而不是 "Action:"                               │
│      - 可能漏掉 Action Input                                                         │
│      - 可能在 Thought 中直接给出答案而忘记写 Final Answer                            │
│                                                                                     │
│   2. JSON 解析容易失败                                                               │
│      - 模型可能输出不合法的 JSON                                                     │
│      - 引号问题、转义问题                                                            │
│      - 需要大量容错代码                                                              │
│                                                                                     │
│   3. 提示词臃肿                                                                      │
│      - 需要详细描述格式                                                              │
│      - 需要给出示例                                                                  │
│      - 浪费大量 token 在格式说明上                                                   │
│                                                                                     │
│   4. 没有规划能力                                                                    │
│      - 每一步只考虑下一步做什么                                                      │
│      - 没有全局任务视图                                                              │
│      - 容易走偏或遗漏任务                                                            │
│                                                                                     │
│   5. 状态管理困难                                                                    │
│      - 所有上下文都在文本中                                                          │
│      - 无法结构化存储中间状态                                                        │
│      - context 越来越长                                                              │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 三、LangChain v1 + Todo 中间件详解

### 3.1 原生工具调用机制

```
╔══════════════════════════════════════════════════════════════════════════════════════╗
║                                                                                      ║
║                      LangChain v1 原生工具调用机制                                    ║
║                                                                                      ║
╠══════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                      ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ Step 1: 工具绑定（在 API 层面）                                             │     ║
║   ├────────────────────────────────────────────────────────────────────────────┤     ║
║   │                                                                            │     ║
║   │   # 代码                                                                    │     ║
║   │   model.bind_tools([weather_tool, search_tool])                            │     ║
║   │                                                                            │     ║
║   │   # 发送给 OpenAI API 的请求                                                │     ║
║   │   {                                                                        │     ║
║   │       "model": "gpt-4o",                                                   │     ║
║   │       "messages": [...],                                                   │     ║
║   │       "tools": [                                                           │     ║
║   │           {                                                                │     ║
║   │               "type": "function",                                          │     ║
║   │               "function": {                                                │     ║
║   │                   "name": "weather",                                       │     ║
║   │                   "description": "获取天气",                                │     ║
║   │                   "parameters": {                                          │     ║
║   │                       "type": "object",                                    │     ║
║   │                       "properties": {                                      │     ║
║   │                           "location": {"type": "string"}                   │     ║
║   │                       }                                                    │     ║
║   │                   }                                                        │     ║
║   │               }                                                            │     ║
║   │           }                                                                │     ║
║   │       ]                                                                    │     ║
║   │   }                                                                        │     ║
║   │                                                                            │     ║
║   │   ✅ 工具定义在 API 层面，不在提示词中！                                     │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                      ↓                                               ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ Step 2: 模型返回【结构化】工具调用                                          │     ║
║   ├────────────────────────────────────────────────────────────────────────────┤     ║
║   │                                                                            │     ║
║   │   # OpenAI API 返回                                                        │     ║
║   │   {                                                                        │     ║
║   │       "choices": [{                                                        │     ║
║   │           "message": {                                                     │     ║
║   │               "role": "assistant",                                         │     ║
║   │               "content": null,                                             │     ║
║   │               "tool_calls": [                                              │     ║
║   │                   {                                                        │     ║
║   │                       "id": "call_abc123",                                 │     ║
║   │                       "type": "function",                                  │     ║
║   │                       "function": {                                        │     ║
║   │                           "name": "weather",                               │     ║
║   │                           "arguments": "{\"location\": \"北京\"}"          │     ║
║   │                       }                                                    │     ║
║   │                   }                                                        │     ║
║   │               ]                                                            │     ║
║   │           }                                                                │     ║
║   │       }]                                                                   │     ║
║   │   }                                                                        │     ║
║   │                                                                            │     ║
║   │   ✅ 返回结构化 JSON，不需要正则解析！                                       │     ║
║   │   ✅ tool_calls 是模型原生能力，格式始终正确！                               │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                      ↓                                               ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ Step 3: LangChain 解析为 AIMessage                                          │     ║
║   ├────────────────────────────────────────────────────────────────────────────┤     ║
║   │                                                                            │     ║
║   │   AIMessage(                                                               │     ║
║   │       content="",                                                          │     ║
║   │       tool_calls=[                                                         │     ║
║   │           {                                                                │     ║
║   │               "id": "call_abc123",                                         │     ║
║   │               "name": "weather",                                           │     ║
║   │               "args": {"location": "北京"}  ← 已解析的 dict！              │     ║
║   │           }                                                                │     ║
║   │       ]                                                                    │     ║
║   │   )                                                                        │     ║
║   │                                                                            │     ║
║   │   ✅ 直接访问 .tool_calls，无需任何解析！                                    │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
╚══════════════════════════════════════════════════════════════════════════════════════╝
```

### 3.2 Todo 中间件的规划能力

```
╔══════════════════════════════════════════════════════════════════════════════════════╗
║                                                                                      ║
║                      Todo 中间件：为什么不是 ReAct？                                  ║
║                                                                                      ║
╠══════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                      ║
║   ReAct 的"思考"：                                                                   ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │                                                                            │     ║
║   │   Thought: 我需要先做 A，然后做 B，最后做 C                                  │     ║
║   │   Action: do_A                                                             │     ║
║   │   ...                                                                      │     ║
║   │   Thought: A 做完了，现在做 B                                               │     ║
║   │   Action: do_B                                                             │     ║
║   │                                                                            │     ║
║   │   ⚠️ 问题：                                                                 │     ║
║   │   - "思考" 只存在于文本中，无法被程序访问                                    │     ║
║   │   - 用户无法看到任务进度                                                    │     ║
║   │   - 如果中断，无法恢复状态                                                  │     ║
║   │   - 模型可能忘记之前的计划                                                  │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
║   Todo 中间件的"规划"：                                                              ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │                                                                            │     ║
║   │   # 模型调用 write_todos 工具                                               │     ║
║   │   write_todos(todos=[                                                      │     ║
║   │       {"content": "做 A", "status": "in_progress"},                        │     ║
║   │       {"content": "做 B", "status": "pending"},                            │     ║
║   │       {"content": "做 C", "status": "pending"}                             │     ║
║   │   ])                                                                       │     ║
║   │                                                                            │     ║
║   │   # 状态被持久化到 state["todos"]                                           │     ║
║   │   state["todos"] = [                                                       │     ║
║   │       {"content": "做 A", "status": "in_progress"},                        │     ║
║   │       {"content": "做 B", "status": "pending"},                            │     ║
║   │       {"content": "做 C", "status": "pending"}                             │     ║
║   │   ]                                                                        │     ║
║   │                                                                            │     ║
║   │   ✅ 优势：                                                                 │     ║
║   │   - 任务列表是【结构化数据】，可被程序访问                                   │     ║
║   │   - 用户可以实时看到任务进度                                                │     ║
║   │   - 可以持久化，支持断点恢复                                                │     ║
║   │   - 模型每次都能看到完整的任务列表                                          │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
╚══════════════════════════════════════════════════════════════════════════════════════╝
```

---

## 四、核心差异对比表

```
┌────────────────────────────┬──────────────────────────────┬──────────────────────────────┐
│           维度              │        传统 ReAct 模式        │   LangChain v1 + Todo 中间件  │
├────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│                            │                              │                              │
│  工具调用方式               │  文本格式 + 正则解析          │  原生 API tool_calls         │
│                            │  "Action: search"            │  tool_calls=[{name, args}]   │
│                            │                              │                              │
├────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│                            │                              │                              │
│  格式稳定性                 │  ❌ 不稳定                    │  ✅ 完全稳定                  │
│                            │  依赖模型遵循提示词格式       │  由 API 保证结构正确          │
│                            │                              │                              │
├────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│                            │                              │                              │
│  思考/规划的存储            │  只在文本中                   │  结构化状态                  │
│                            │  Thought: ...                │  state["todos"] = [...]      │
│                            │  程序无法访问                 │  程序可读写                  │
│                            │                              │                              │
├────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│                            │                              │                              │
│  任务进度可见性             │  ❌ 用户看不到                │  ✅ 用户实时可见              │
│                            │  隐藏在 Thought 文本中        │  todos 状态可展示给用户       │
│                            │                              │                              │
├────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│                            │                              │                              │
│  断点恢复能力               │  ❌ 困难                      │  ✅ 支持                      │
│                            │  需要完整保存对话历史         │  checkpointer 保存状态       │
│                            │                              │  包括 todos                  │
│                            │                              │                              │
├────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│                            │                              │                              │
│  提示词开销                 │  ❌ 大                        │  ✅ 小                        │
│                            │  需要描述格式 + 示例          │  工具定义在 API 层           │
│                            │  ~500-1000 tokens            │  只需任务相关提示            │
│                            │                              │                              │
├────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│                            │                              │                              │
│  扩展性                     │  ❌ 差                        │  ✅ 好                        │
│                            │  添加功能需要修改提示词       │  添加中间件即可              │
│                            │  可能破坏格式                 │  完全解耦                    │
│                            │                              │                              │
├────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│                            │                              │                              │
│  循环控制                   │  检测 "Final Answer"         │  检测 tool_calls 是否为空    │
│                            │  文本匹配                     │  API 结构判断                │
│                            │                              │                              │
├────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│                            │                              │                              │
│  并行工具调用               │  ❌ 不支持                    │  ✅ 支持                      │
│                            │  一次只能解析一个 Action      │  tool_calls 可包含多个       │
│                            │                              │  Send 并行执行               │
│                            │                              │                              │
├────────────────────────────┼──────────────────────────────┼──────────────────────────────┤
│                            │                              │                              │
│  模型要求                   │  任何模型                     │  支持 function calling       │
│                            │  但效果差异大                 │  的模型                      │
│                            │                              │                              │
└────────────────────────────┴──────────────────────────────┴──────────────────────────────┘
```

---

## 五、执行流程对比

### 5.1 相同任务的两种执行方式

任务：创建 login.tsx 和 register.tsx 两个文件

```
╔══════════════════════════════════════════════════════════════════════════════════════╗
║                                                                                      ║
║                              传统 ReAct 执行流程                                      ║
║                                                                                      ║
╠══════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                      ║
║   第 1 轮:                                                                           ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ 提示词: "...Use format: Thought/Action/Observation..."                     │     ║
║   │ 问题: "创建 login.tsx 和 register.tsx"                                     │     ║
║   │                                                                            │     ║
║   │ 模型输出:                                                                   │     ║
║   │ "Thought: 用户需要创建两个文件，我先创建 login.tsx                           │     ║
║   │  Action: create_file                                                       │     ║
║   │  Action Input: {"filename": "login.tsx", "content": "..."}"               │     ║
║   │                                                                            │     ║
║   │ 正则解析 → 执行工具 → 拼接 Observation                                      │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
║   第 2 轮:                                                                           ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ 提示词（累积）:                                                             │     ║
║   │ "...之前的对话...                                                          │     ║
║   │  Observation: 文件 login.tsx 已创建                                        │     ║
║   │  Thought:"                                                                 │     ║
║   │                                                                            │     ║
║   │ 模型输出:                                                                   │     ║
║   │ "Thought: login.tsx 创建完成，现在创建 register.tsx                         │     ║
║   │  Action: create_file                                                       │     ║
║   │  Action Input: {"filename": "register.tsx", "content": "..."}"            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
║   第 3 轮:                                                                           ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │ 模型输出:                                                                   │     ║
║   │ "Thought: 两个文件都创建完成了                                              │     ║
║   │  Final Answer: 已创建 login.tsx 和 register.tsx"                           │     ║
║   │                                                                            │     ║
║   │ 检测到 "Final Answer" → 结束                                               │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
║   ⚠️ 问题：                                                                          ║
║   - 没有任务列表，用户不知道总共要做几件事                                           ║
║   - 如果第 2 轮崩溃，无法恢复                                                        ║
║   - 无法知道"register.tsx 还没创建"这个状态                                          ║
║                                                                                      ║
╚══════════════════════════════════════════════════════════════════════════════════════╝
```

```
╔══════════════════════════════════════════════════════════════════════════════════════╗
║                                                                                      ║
║                       LangChain v1 + Todo 中间件执行流程                              ║
║                                                                                      ║
╠══════════════════════════════════════════════════════════════════════════════════════╣
║                                                                                      ║
║   第 1 轮 (model #1):                                                                ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │                                                                            │     ║
║   │ 消息: [HumanMessage("创建 login.tsx 和 register.tsx")]                     │     ║
║   │ 可用工具: [create_file, write_todos]                                       │     ║
║   │                                                                            │     ║
║   │ 模型返回 (结构化):                                                          │     ║
║   │ AIMessage(                                                                 │     ║
║   │     tool_calls=[{                                                          │     ║
║   │         "name": "write_todos",                                             │     ║
║   │         "args": {                                                          │     ║
║   │             "todos": [                                                     │     ║
║   │                 {"content": "创建 login.tsx", "status": "in_progress"},    │     ║
║   │                 {"content": "创建 register.tsx", "status": "pending"}      │     ║
║   │             ]                                                              │     ║
║   │         }                                                                  │     ║
║   │     }]                                                                     │     ║
║   │ )                                                                          │     ║
║   │                                                                            │     ║
║   │ → tools 节点执行 write_todos                                               │     ║
║   │ → state["todos"] 更新                                                      │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
║   state["todos"] = [                                                                 ║
║       {"content": "创建 login.tsx", "status": "in_progress"},  ← 用户可见！         ║
║       {"content": "创建 register.tsx", "status": "pending"}    ← 用户可见！         ║
║   ]                                                                                  ║
║                                                                                      ║
║   第 2 轮 (model #2):                                                                ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │                                                                            │     ║
║   │ 模型返回:                                                                   │     ║
║   │ AIMessage(tool_calls=[{                                                    │     ║
║   │     "name": "create_file",                                                 │     ║
║   │     "args": {"filename": "login.tsx", "content": "..."}                    │     ║
║   │ }])                                                                        │     ║
║   │                                                                            │     ║
║   │ → tools 节点执行 create_file                                               │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
║   第 3 轮 (model #3):                                                                ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │                                                                            │     ║
║   │ 模型返回 (同时调用两个工具！):                                               │     ║
║   │ AIMessage(tool_calls=[                                                     │     ║
║   │     {                                                                      │     ║
║   │         "name": "write_todos",  ← 更新状态                                 │     ║
║   │         "args": {"todos": [                                                │     ║
║   │             {"content": "创建 login.tsx", "status": "completed"},          │     ║
║   │             {"content": "创建 register.tsx", "status": "in_progress"}      │     ║
║   │         ]}                                                                 │     ║
║   │     },                                                                     │     ║
║   │     {                                                                      │     ║
║   │         "name": "create_file",  ← 同时创建文件                             │     ║
║   │         "args": {"filename": "register.tsx", "content": "..."}             │     ║
║   │     }                                                                      │     ║
║   │ ])                                                                         │     ║
║   │                                                                            │     ║
║   │ → tools 节点【并行】执行两个工具！                                          │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
║   state["todos"] = [                                                                 ║
║       {"content": "创建 login.tsx", "status": "completed"},     ← ✅                ║
║       {"content": "创建 register.tsx", "status": "in_progress"} ← 🔄                ║
║   ]                                                                                  ║
║                                                                                      ║
║   第 4 轮 (model #4):                                                                ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │                                                                            │     ║
║   │ 模型返回:                                                                   │     ║
║   │ AIMessage(tool_calls=[{                                                    │     ║
║   │     "name": "write_todos",                                                 │     ║
║   │     "args": {"todos": [                                                    │     ║
║   │         {"content": "创建 login.tsx", "status": "completed"},              │     ║
║   │         {"content": "创建 register.tsx", "status": "completed"}            │     ║
║   │     ]}                                                                     │     ║
║   │ }])                                                                        │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
║   state["todos"] = [                                                                 ║
║       {"content": "创建 login.tsx", "status": "completed"},     ← ✅                ║
║       {"content": "创建 register.tsx", "status": "completed"}   ← ✅                ║
║   ]                                                                                  ║
║                                                                                      ║
║   第 5 轮 (model #5):                                                                ║
║   ┌────────────────────────────────────────────────────────────────────────────┐     ║
║   │                                                                            │     ║
║   │ 模型返回:                                                                   │     ║
║   │ AIMessage(                                                                 │     ║
║   │     content="已完成所有任务...",                                           │     ║
║   │     tool_calls=[]  ← 空的，触发结束                                        │     ║
║   │ )                                                                          │     ║
║   │                                                                            │     ║
║   └────────────────────────────────────────────────────────────────────────────┘     ║
║                                                                                      ║
║   ✅ 优势：                                                                          ║
║   - 用户始终能看到任务列表和进度                                                     ║
║   - 如果第 3 轮崩溃，checkpointer 可恢复到 state["todos"]                            ║
║   - 可以并行执行多个工具                                                             ║
║   - 结构化数据，无需解析                                                             ║
║                                                                                      ║
╚══════════════════════════════════════════════════════════════════════════════════════╝
```

---

## 六、总结

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                     │
│                              核心差异一句话总结                                       │
│                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   ReAct = 用【提示词】教模型输出【文本格式】，然后【解析文本】                         │
│                                                                                     │
│   LangChain v1 + Todo = 用【原生 API】获取【结构化数据】，用【状态机】驱动流程        │
│                                                                                     │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│   Todo 中间件不是 ReAct 的变种，而是完全不同的架构：                                  │
│                                                                                     │
│   1. 不依赖 Thought/Action/Observation 格式                                          │
│   2. 不使用正则解析                                                                  │
│   3. 任务规划是【结构化状态】而非【文本思考】                                         │
│   4. 通过【工具】实现规划，而非【提示词格式】                                         │
│   5. 状态可持久化、可恢复、用户可见                                                   │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

