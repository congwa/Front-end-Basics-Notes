# docker镜像的分层

我们知道docker镜像每层指令都会创建一个新的层，当您更改 Dockerfile 并重新构建镜像时，**仅重建那些已更改的层**。这里深入了解一下细节。


Docker 镜像具有分层结构，每个分层包含了部分文件系统的文件，在 Docker 容器启动时，这些分层会组合成一个完整的文件系统。

## 镜像分层的原理

每个 Docker 镜像都由多个只读层组成，每个层都是基于上一个层创建的。

当容器启动时，Docker 将这些层组合在一起形成容器的文件系统。每个层都由文件或目录的变更组成，这可以是添加、修改或删除文件。因此，如果我们修改了一个镜像的任何层，都会影响到它自身和继承它的所有容器。

```shell
Layer 3 - Modified Files
Layer 2 - Modified Files
Layer 1 - Modified Files
Layer 0 - Base Image
```

- Layer 0 是基础镜像，是其他层的基础，包含了操作系统
- Layer 1 包含操作系统上编译的软件（例如Apache）
- Layer 2 包含操作系统和软件上的配置信息
- Layer 3 包含应用程序和数据文件


## 镜像分层的优点


- 共享：Docker 镜像的不同部分（层）可以被多个镜像共享。例如，可以有一个镜像作为基础镜像，其他镜像在此基础上构建而来。
- 缓存：Docker 使用每个镜像的层缓存中间状态。如果再次构建一个基于原始镜像的容器时，Docker 会使用缓存而不是再一次构建完整的镜像。
- 聚焦：每个层都包含了完整的文件系统，因此不必将所有文件复制到一个镜像中。这使得镜像更加轻量级。
