# 设置哈希

在 Nginx 中，为了快速处理静态数据集，例如服务器名称、映射指令值、MIME 类型、请求头字符串等，使用了哈希表。在启动和每次重新配置 Nginx 时，会选择最小化的哈希表大小，以使存储相同哈希值的键的桶大小不超过配置参数（哈希桶大小）。表的大小以桶表示。调整将继续进行，直到表的大小超过哈希最大大小参数。大多数哈希具有相应的指令，允许更改这些参数，例如，对于服务器名称哈希，它们是 server_names_hash_max_size 和 server_names_hash_bucket_size。

哈希桶大小参数被调整为大小是处理器缓存行大小的倍数。这通过减少内存访问次数来加速现代处理器上哈希键搜索。如果哈希桶大小等于一个处理器缓存行大小，则在键搜索期间内存访问次数最多为两次——第一次是计算桶地址，第二次是在桶内进行键搜索。因此，如果 Nginx 发出请求以增加哈希最大大小或哈希桶大小，则应首先增加第一个参数。

简单来说，**Nginx 使用哈希表来快速处理静态数据集，通过调整哈希表的大小和桶的大小，可以提高键搜索的速度**。如果要增加哈希表的大小或桶的大小，则应该先增加哈希表的大小参数，以实现更好的性能。