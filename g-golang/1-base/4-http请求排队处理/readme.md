# http请求排队处理

![http请求排队处理](/study/imgs/go_http_queen.png)

- Job结构体中有一个handleJob，其类型是一个函数，即处理请求的逻辑部分。DoneChan通道用来让该单元进行阻塞等待，并当handleJob执行完毕后发送消息通知的
- List队列主要是用来存储工作单元的。是处理请求的主协程和消费协程之间的纽带。队列具有列表、容量、当前元素个数等关键元素组成。
- WorkerManager结构体，负责管理具体的消费协程
- 消费者协程的职责是监听队列，并从队列中获取工作单元，执行工作单元的具体处理逻辑。在实际应用中，可以根据系统的承载能力启用多个消费协程。在本文中，为了方便讲解，我们只启用一个消费协程。
  - createWorker中的逻辑实际是一个for循环，然后通过select监听队列的noticeChan通道，当获取到工作单元时，就执行工作单元中的handleJob方法。执行完后，通过job.Done()方法通知在主协程中还等待的job。这样整个流程就形成了闭环

作者：Go学堂
链接：https://juejin.cn/post/7121252800469663774
来源：稀土掘金
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

1. 实现思路：通过将请求的上下文信息封装到一个工作单元中，并将其放入到队列中，然后通过消息通道的方式阻塞等待消费者执行完毕。同时在队列中通过设置队列的容量以解决请求过多而给系统造成压力的问题
2. 目的： 高并发下，保护系统过载，在对响应延迟有要求的情况下，等待时间长的就可以从队列删除，让后进来的请求得到优先处理

3. 优先级队列：实际上就是该队列的高级实现版本，可以将不同的请求按优先级分配到不同的队列中





## 参考

- [Go实战 | 一文带你搞懂从单队列到优先级队列的实现](https://mp.weixin.qq.com/s?__biz=MzkyMjE5Mzg3Nw==&mid=2247484105&idx=1&sn=2d1a7e2f388287b11096faed1804a10f&chksm=c1f95873f68ed1657382068ea58565b0c6b92de46fcc590449c4b1f25c8263bf2bec5e74ea66#rd)
- [Go实战 | http请求排队处理的实现](https://juejin.cn/post/7121252800469663774)